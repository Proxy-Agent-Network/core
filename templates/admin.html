<!DOCTYPE html>
<html lang="en" data-theme="business">
<head>
    <meta charset="UTF-8">
    <title>Admin Control | Proxy Agent Network</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Inter:wght@400;700&family=Montserrat:wght@400;700&family=Orbitron:wght@400;700&family=Press+Start+2P&family=Shrikhand&family=Special+Elite&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <script src="{{ url_for('static', filename='js/theme-engine.js') }}"></script>
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'business';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
</head>
<body>
    <div class="header">
        <h1>Admin Control Center</h1>
        
        <div class="controls-panel" style="display: flex; align-items: center; gap: 20px; margin-left: auto;">
            <a href="/" style="color: var(--accent); font-weight: bold; text-decoration: none; border-bottom: 2px solid var(--accent);">View Dashboard</a>
            <select id="common-theme-selector" class="theme-picker-ui">
                <option>Loading Themes...</option>
            </select>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="panel">
            <h2>Inject Manual Task</h2>
            <form method="POST" style="display: flex; flex-direction: column; gap: 10px;">
                <input type="hidden" name="action" value="post_task">
                <input type="text" name="task_id" placeholder="Task ID (e.g. MANUAL-01)" required style="padding: 10px; border-radius: 4px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-family: inherit;">
                <input type="number" name="bid_sats" placeholder="Sats Reward" required style="padding: 10px; border-radius: 4px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-family: inherit;">
                <button type="submit" style="background: var(--accent); color: #fff; border: none; padding: 10px; cursor: pointer; border-radius: 4px; font-weight: bold; font-family: inherit;">DEPLOY TASK</button>
            </form>
        </div>

        <div class="panel">
            <h2>Danger Zone</h2>
            <p style="opacity: 0.8; margin-bottom: 15px;">Clear all node XP, levels, and task history.</p>
            <button onclick="confirmReset()" style="background: #ff4757; color: #fff; border: none; padding: 12px; width: 100%; cursor: pointer; border-radius: 4px; font-weight: bold; font-family: inherit;">WIPE NETWORK</button>
        </div>

        <div class="panel" style="grid-column: span 2;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px dashed var(--border); padding-bottom: 10px;">
                <h2 style="border:none; margin:0;">Connected Node Registry</h2>
                <input type="text" id="node-search" placeholder="ðŸ” Search Nodes..." 
                    style="padding: 8px 12px; border-radius: 4px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-family: inherit; width: 250px;">
            </div>

            <table style="width: 100%; text-align: left; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--border);">
                        <th style="padding: 10px;">Node ID</th>
                        <th style="padding: 10px;">Level</th>
                        <th style="padding: 10px;">XP</th>
                        <th style="padding: 10px;">Total Earned</th>
                    </tr>
                </thead>
                <tbody id="node-table-body">
                    {% for node in nodes %}
                    <tr class="node-row" style="border-bottom: 1px solid rgba(128,128,128,0.2);">
                        <td style="padding: 10px;">{{ node.node_id }}</td>
                        <td style="padding: 10px;">{{ node.level }}</td>
                        <td style="padding: 10px;">{{ node.xp }}</td>
                        <td style="padding: 10px; color: var(--accent); font-weight: bold;">{{ node.total_earned }} Sats</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div id="no-results" style="display:none; text-align:center; padding: 20px; opacity: 0.6;">
                No nodes matching that search criteria...
            </div>
        </div>
    </div>

    <script>
        function confirmReset() {
            if(confirm("Are you absolutely sure? This will wipe the database.")) {
                window.location.href = "/debug/reset_me";
            }
        }

        // Search Logic
        document.getElementById('node-search').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('.node-row');
            const noResults = document.getElementById('no-results');
            let foundAny = false;

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = "";
                    foundAny = true;
                } else {
                    row.style.display = "none";
                }
            });
            noResults.style.display = foundAny ? "none" : "block";
        });

        window.addEventListener('DOMContentLoaded', () => {
            if (typeof ThemeEngine !== 'undefined') {
                ThemeEngine.init('common-theme-selector');
            }
        });
    </script>
</body>
</html>