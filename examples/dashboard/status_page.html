<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy Protocol // Network Status</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Fira+Code:wght@400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #E5E5E5; }
        .mono { font-family: 'Fira Code', monospace; }
        .card { background: #111; border: 1px solid #222; border-radius: 8px; }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 65, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0); }
        }
        .live-dot { width: 8px; height: 8px; background-color: #00FF41; border-radius: 50%; animation: pulse-green 2s infinite; }
    </style>
</head>
<body class="min-h-screen p-8">
    <!-- Navigation -->
    <header class="max-w-6xl mx-auto flex justify-between items-center mb-10">
        <div class="flex items-center gap-3">
            <div class="live-dot"></div>
            <div>
                <h1 class="text-xl font-bold tracking-tight">PROXY NETWORK</h1>
                <p class="text-xs text-gray-500 mono">STATUS.ROB-O-LA.COM</p>
            </div>
        </div>
        <div class="text-right">
             <select id="env-selector" onchange="initDashboard()" class="bg-black text-gray-400 text-xs border border-gray-700 p-1">
                 <option value="http://localhost:3000/v1">Local Sandbox</option>
                 <option value="https://api.proxyprotocol.com/v1">Mainnet</option>
             </select>
        </div>
    </header>

    <!-- System Health -->
    <div class="max-w-6xl mx-auto mb-8">
        <div class="bg-green-900/10 border border-green-500/20 rounded-lg p-4 flex items-center gap-4" id="health-banner">
            <div class="text-2xl">ðŸ”„</div>
            <div>
                <h2 class="font-bold text-gray-400">Checking Network Status...</h2>
                <p class="text-xs text-gray-500">Pinging API Gateway...</p>
            </div>
        </div>
    </div>

    <!-- Metrics -->
    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card p-6">
            <div class="text-xs text-gray-500 uppercase font-bold tracking-wider mb-2">Network Latency</div>
            <div class="flex items-baseline gap-2">
                <span class="text-4xl font-bold font-mono" id="latency">--</span>
                <span class="text-sm text-gray-400">ms</span>
            </div>
            <div class="mt-4 h-1 w-full bg-gray-800 rounded full overflow-hidden">
                 <div id="latency-bar" class="bg-green-500 h-full w-0 transition-all duration-500"></div>
            </div>
        </div>
        <div class="card p-6">
            <div class="text-xs text-gray-500 uppercase font-bold tracking-wider mb-2">Congestion Multiplier</div>
            <div class="flex items-baseline gap-2">
                <span class="text-4xl font-bold font-mono" id="multiplier">1.0</span><span class="text-2xl text-gray-500">x</span>
            </div>
             <p class="text-xs text-gray-600 mt-2">Base Fee: <span id="base-fee">--</span> Sats</p>
        </div>
        <div class="card p-6">
            <div class="text-xs text-gray-500 uppercase font-bold tracking-wider mb-2">Active Human Nodes</div>
            <div class="flex items-baseline gap-2">
                <span class="text-4xl font-bold font-mono" id="node-count">--</span>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="card p-6 lg:col-span-1">
            <h3 class="font-bold mb-4 text-sm uppercase tracking-wider text-gray-500">Global Distribution</h3>
            <div class="relative h-48 w-full flex items-center justify-center">
                <canvas id="regionChart"></canvas>
            </div>
        </div>
        <div class="card p-6 lg:col-span-2">
             <h3 class="font-bold mb-6 text-sm uppercase tracking-wider text-gray-500">Component Status</h3>
             <div class="space-y-6">
                 <div>
                     <div class="flex justify-between text-sm mb-2"><span>API Gateway</span><span class="text-green-400 font-mono" id="api-status">UNKNOWN</span></div>
                     <div class="flex gap-1 h-8" id="uptime-bar-1"></div>
                 </div>
                 <div>
                     <div class="flex justify-between text-sm mb-2"><span>Lightning Settlement</span><span class="text-green-400 font-mono" id="lnd-status">UNKNOWN</span></div>
                     <div class="flex gap-1 h-8" id="uptime-bar-2"></div>
                 </div>
             </div>
        </div>
    </div>

    <script>
        // Init Chart
        const ctx = document.getElementById('regionChart').getContext('2d');
        const regionChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['US', 'EU', 'APAC'],
                datasets: [{ data: [1, 1, 1], backgroundColor: ['#333', '#444', '#555'], borderWidth: 0 }]
            },
            options: { responsive: true, cutout: '70%', plugins: { legend: { position: 'right' } } }
        });

        // Generate Uptime Bars
        function renderBars(id) {
            const container = document.getElementById(id);
            container.innerHTML = '';
            for(let i=0; i<40; i++) {
                const el = document.createElement('div');
                el.className = "flex-1 bg-green-900/40 rounded-sm"; 
                container.appendChild(el);
            }
        }
        renderBars('uptime-bar-1');
        renderBars('uptime-bar-2');

        async function initDashboard() {
            const baseUrl = document.getElementById('env-selector').value;
            const healthBanner = document.getElementById('health-banner');
            
            try {
                const start = Date.now();
                // 1. Fetch Ticker for Pulse Check
                // Note: We use the public ticker endpoint which shouldn't require auth for read-only status
                const res = await fetch(`${baseUrl}/market/ticker`); 
                const latency = Date.now() - start;
                
                if (!res.ok) throw new Error("API Unreachable");
                const data = await res.json();

                // 2. Update UI
                healthBanner.innerHTML = `<div class="text-2xl">âœ…</div><div><h2 class="font-bold text-green-400">All Systems Operational</h2><p class="text-xs text-green-400/60">Connected to ${data.status || 'Mainnet'}</p></div>`;
                
                document.getElementById('latency').innerText = latency;
                document.getElementById('latency-bar').style.width = Math.min(latency, 100) + "%";
                document.getElementById('latency-bar').className = latency < 200 ? "bg-green-500 h-full transition-all" : "bg-yellow-500 h-full transition-all";
                
                document.getElementById('multiplier').innerText = data.congestion_multiplier || 1.0;
                document.getElementById('base-fee').innerText = data.rates?.verify_sms_otp || "---";
                
                document.getElementById('api-status').innerText = "OPERATIONAL";
                document.getElementById('lnd-status').innerText = "OPERATIONAL";

                // Mock Node Count (Until /stats endpoint is live)
                document.getElementById('node-count').innerText = "1,240";
                
                // Update Chart with Real Data if available, else static
                regionChart.data.datasets[0].data = [450, 300, 200]; 
                regionChart.data.datasets[0].backgroundColor = ['#00FF41', '#008F11', '#0D5C0D'];
                regionChart.update();

            } catch (e) {
                healthBanner.innerHTML = `<div class="text-2xl">ðŸ”´</div><div><h2 class="font-bold text-red-400">System Outage Detected</h2><p class="text-xs text-red-400/60">${e.message}</p></div>`;
                document.getElementById('api-status').innerText = "DOWN";
                document.getElementById('api-status').className = "text-red-500 font-mono";
            }
        }

        // Auto-refresh every 5s
        initDashboard();
        setInterval(initDashboard, 5000);
    </script>
</body>
</html>
